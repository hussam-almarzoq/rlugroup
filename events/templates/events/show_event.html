{% extends 'base.html' %}
{% block title %}{{ event.name }}{% endblock %}
{% block content %}

<script src="http://www.openlayers.org/api/OpenLayers.js"></script>
    <style type="text/css">
      #eventmap {
          width: 100%;
          height: 200px;
          margin: 0;
      }
    </style>
<script>
$(function() {
        map = new OpenLayers.Map("eventmap");
        var mapnik         = new OpenLayers.Layer.OSM();
        var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
        var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
        var position       = new OpenLayers.LonLat({{ event.long_position|stringformat:"f" }}, {{ event.lat_position|stringformat:"f" }}).transform( fromProjection, toProjection);
        var zoom           = 15;
        var markers = new OpenLayers.Layer.Markers( "Markers" );
        map.addLayer(markers);
        map.addLayer(mapnik);
        markers.addMarker(new OpenLayers.Marker(position));
        map.setCenter(position, zoom );
        map.addControl(new OpenLayers.Control.Permalink('permalink'));
      });
</script>
<div class="row">
<h2>{{ event.name }}</h2>
</div>
<div class="row">
<div id="eventmap"></div> 
</div>
<div class="row">
	<div class="col-md-9">
	<table class="table-hover table">
		<colgroup>
			<col class="col-xs-2">
			<col class="col-xs-7">
		</colgroup>
		<tr>
			<th>الوصف</th>
			<td>{{ event.description }}</td>
		</tr>
		<tr>
			<th>المكان</th>
			<td>{{ event.location }}<br/>{{ event.location_description }}<br/>الإحداثيات: {{ event.lat_position|stringformat:"f" }}, {{ event.long_position|stringformat:"f" }}</td>
		</tr>
		<tr>

{% if event.starting_date|date:"nj" == event.ending_date|date:"nj" %}
			<th>الوقت</th>
			<td>{{ event.starting_date|date:"l j F o"  }}</br>من {{ event.starting_date|date:"h:i"  }} إلى {{ event.ending_date|date:"h:i"  }}</td>
		</tr>
{% else %}
		<tr>
			<th>البدء</th>
			<td>{{ event.starting_date }}</td>
		</tr>
		<tr>
			<th>الانتهاء</th>
			<td>{{ event.ending_date }}</td>
		</tr>
{% endif %}
	</table>
	</div>
	<div class="col-md-3">
		{% if perms.events.change_event %}
			<p><a href="{% url 'events:edit_event' event.pk %}" class="form-control btn btn-warning"><span class="glyphicon glyphicon-pencil"></span> عدل النشاط</a></p>
		{% endif %}
		{% if attendable %}
			<p><a href="{% url 'events:attend' event.pk %}" class="form-control btn btn-success"><span class="glyphicon glyphicon-star-empty"></span> احضر</a></p>
		{% endif %}
	</div>
</div>

{% endblock %}
